{% block empty %}
    <tr>
        <td colspan="{{ thead|length + (allow_select ? 1 : 0) }}">
    <center>Aucun élément à afficher</center>
</td>
</tr>
{% endblock %}

{% block filter %}
    <div class="input-group">
        <span class="input-group-addon"><i class="fa fa-search"></i></span>
        <input type="text" class="form-control" name="_filter" placeholder="Rechercher"/>
    </div>
{% endblock %}

{% block thead %}
    {% if has_filter or caption %}
        <tr>
            <td colspan="{{ thead|length + (allow_select ? 1 : 0)}}">
                {% if caption %}
                    <span class="caption">{{ caption }}</span>
                {% endif %}
                {% if has_filter %}
                    {{ block('filter') }}
                {% endif %}
            </td>
        </tr>
    {% endif %}
    <tr>
        {% if allow_select %}
            <th></th>
            {% endif %}
            {% for key, th in thead %}
                {% if th.sort != 0 %}
                <th class="sortable" data-sort="{{ th.sort }}">
            <div class="dropdown">
                {{ th.title }}
                <span class="caret"></span>
            </div>
        </th>
    {% else %}
        <th>{{ th.title }}</th>
        {% endif %}
    {% endfor %}
</tr>
{% endblock %}

{% block tbody %}
    {% if tbody|length > 0 %}
        {{ block('rows') }}
    {% else %}
        {{ block('empty') }}
    {% endif %}
{% endblock %}

{% block tfoot %}
    <tr>
        <td colspan="{{ thead|length + (allow_select ? 1 : 0) }}">
            {{ block('pages') }}
            {{ block('limit_select') }}
        </td>
    </tr>
{% endblock %}

{% block limit_select %}
    {% if total > 10 %}
        <select id="{{ attrs.id }}_limit" class="selectpicker btn-xs" data-width="70px">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="0">Tous</option>
        </select>
    {% endif %}
{% endblock %}

{% block table %}

    {% set attrs = attrs|merge({
            'class': attrs.class|default('') ~ ' emc-table table table-hover table-condensed table-striped table-responsive',
            'data-route': path(route, params ? {'tid':id, 'params' : params} : {'tid':id})|raw,
            'data-subtable-route' : subtid ? path(route, {'tid':subtid})|raw : "null",
            'data-limit' : limit,
            'data-selectable' : allow_select
        }) %}
    <table {{ block('attributes') }}>
        <thead>
            {{ block('thead') }}
        </thead>
        <tbody>
            {{ block('tbody') }}
        </tbody>
        <tfoot>
            {{ block('tfoot') }}
        </tfoot>
    </table>
    {{ block('javascript') }}

{% endblock %}

{% block javascript %}
    <script type="text/javascript">
        $(function() {
            EMCTable.EMPTY = 'Aucun élément à afficher';
            EMCTable.handle(document.getElementById('{{ attrs.id }}'));
        });
    </script>
{% endblock %}

{% block pages %}
    {% if limit > 0 %}
        {% set current = page %}
        {% set previous = max(1, page - 1) %}
        {% set pageCount = (total/limit)|round(0,'ceil') %}
        {% set next = min(pageCount, page + 1) %}
        {% set maxRange = min(pageCount,max(5,page+2)) %}
        {% set pagesInRange = range(max(1,min(page-2, maxRange-4)),maxRange) %}
    {% endif %}

    {% if limit > 0 and pageCount > 1 %}
        <ul class="pagination pagination-sm">

            {% if current > 1 %}
                <li class="previous"><a class="hidden-xs" data-page="1">&laquo;</a></li>
                <li class="previous"><a class="hidden-xs" data-page="{{previous}}">&lsaquo;</a></li>
                {% else %}
                <li class="previous"><span class="hidden-xs">&laquo;</span></li>
                <li class="previous"><span class="hidden-xs">&lsaquo;</span></li>
                {% endif %}

            {% for page in pagesInRange %}
                {% if page != current %}
                    <li class="page"><a data-page="{{page}}">{{ page }}</a></li>
                    {% else %}
                    <li class="current active" data-page="{{page}}"><a>{{ page }}</a></li>
                        {% endif %}
                    {% endfor %}

            {% if current < pageCount %}
                <li class="next"><a class="hidden-xs" data-page="{{next}}">&rsaquo;</a></li>
                <li class="next"><a class="hidden-xs" data-page="{{pageCount}}">&raquo;</a></li>
                {% else %}
                <li class="next"><span class="hidden-xs">&rsaquo;</span></li>
                <li class="next"><span class="hidden-xs">&raquo;</span></li>
                {% endif %}
        </ul>
    {% endif %}

{% endblock %}

{% block rows %}
    {% for idx, tr in tbody %}
        <tr 
            {% if tr.subtable %}
                data-subtable={{ tr.subtable|json_encode() }}
            {% endif %}
            {% if allow_select %}
                data-selectable="true"
            {% endif %}
            {% if tr.params %}
                {% set rowId = "row" %}
                {% for key, val in tr.params %}
                    data-{{ camel_case_to_option(key) }}="{{val}}"
                    {% set rowId = rowId ~ '_' ~ val %}
                {% endfor%}
                id="{{ rowId }}"
            {% endif %}
            >
            {% if allow_select %}
                <td class="column-select-checkbox"><input type="checkbox" /></td>
                {% endif %}
                {% for idx, td in tr.data %}
                <td class="column-{{ td.name }}">{{ table_cell(td) }}</td>
                {% endfor %}
        </tr>
    {% endfor %}
    {% if rows_pad and limit > 0 and tbody|length < limit-1 and total > limit %}
        {% for idx in tbody|length..limit %}
            <tr class="empty">
                <td colspan="{{ thead|length + (allow_select ? 1 : 0) }}"><div></div></td>
            </tr>
        {% endfor %}
    {% endif %}
{% endblock %}

{% block params %}
    {% for key, val in params %}
        data-_{{ key }}="{{ val }}"
    {% endfor %}
{% endblock %}

{% block attributes %}
    {% for key, val in attrs %}
        {{ key }}="{{ val }}"
    {% endfor %}
{% endblock %}